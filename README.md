
# Python + PostgreSQL Docker-проект

## Описание проекта

Данный проект представляет собой Python-скрипт, взаимодействующий с базой данных PostgreSQL. Скрипт каждые 60 секунд генерирует случайные данные и записывает их в базу данных. Если количество строк в таблице достигает 30, таблица автоматически очищается и запись начинается с первой строки.

Проект разворачивается с помощью Docker Compose и включает три контейнера:
1. **Python** — выполняет скрипт для генерации данных.
2. **PostgreSQL** — база данных, в которую записываются сгенерированные данные.
3. **pgAdmin** — графический интерфейс для управления базой данных.

## Структура проекта

- **app.py**
- **Dockerfile**
- **docker-compose.yml**
- **requirements.txt**
- **.gitignore**
- **.env**

## Как запустить проект

1. Установите Docker и Docker Compose на вашем компьютере.
2. Клонируйте репозиторий проекта.
3. Создайте файл `.env` в корне проекта с переменной окружения `DATABASE_URL`, указывающей на строку подключения к базе данных PostgreSQL.

   Пример файла `.env`:
   ```
   DATABASE_URL=postgresql://user:password@postgres:5432/mydatabase
   DATA_INSERT_INTERVAL=60
   TABLE_CLEAR_THRESHOLD=30
   ```

4. Запустите Docker Compose:
   ```bash
   docker-compose up
   ```

5. Скрипт начнёт работать и каждые 60 секунд будет отправлять сгенерированные данные в базу данных.

## Графическое управление базой данных

В проект включен **pgAdmin** для удобного графического управления базой данных PostgreSQL. Вы можете использовать его для просмотра, редактирования и администрирования базы данных через веб-интерфейс.

### Как настроить pgAdmin:

1. Запустите Docker Compose (включая контейнер **pgAdmin**).
2. Откройте браузер и перейдите по адресу `http://localhost:5050`.
3. Введите email и пароль, указанные в переменных окружения для **pgAdmin**:
   - Email
   - Пароль
4. В **pgAdmin** создайте новое подключение к базе данных PostgreSQL, указав:
   - Хост: `postgres`
   - Порт: `5432`
   - Имя пользователя и пароль, указанные в вашем файле `.env`.

## Логика работы

- Скрипт каждую минуту генерирует случайную строку данных длиной 10 символов.
- Данные записываются в таблицу `data_table` базы данных PostgreSQL с полями:
  - `id` — уникальный идентификатор записи.
  - `data` — сгенерированные данные.
  - `date` — дата и время вставки записи.
- Если количество строк в таблице достигает 30, таблица очищается, и записи начинаются сначала.

## Логи

Скрипт логирует свою работу, включая:
- Успешные подключения к базе данных.
- Вставку данных в таблицу.
- Очищение таблицы при достижении порога строк.

## Примечания

- Время интервала вставки данных можно настроить через переменную окружения `DATA_INSERT_INTERVAL` (по умолчанию 60 секунд).
- Порог очистки таблицы настраивается через переменную окружения `TABLE_CLEAR_THRESHOLD` (по умолчанию 30 строк).

## Пример логов

```
2024-09-25 12:00:00 - INFO - Connected to the database successfully
2024-09-25 12:01:00 - INFO - Inserted: abcdefghij at 2024-09-25 12:01:00
2024-09-25 12:01:00 - DEBUG - Table not cleared. Current row count: 10
...
2024-09-25 12:30:00 - INFO - Table successfully cleared! 30 rows were deleted.
```

## Завершение работы

Чтобы завершить работу скрипта, выполните команду:
```bash
docker-compose down
```
